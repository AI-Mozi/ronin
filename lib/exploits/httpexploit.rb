require 'parameters'
require 'net/http'

module Ronin
  module HTTPExploit

    include Parameters

    def http_session
      unless rhost
        raise MissingParam, "Missing '#{param_desc(:rhost)}' parameter", caller
      end

      unless rport
        raise MissingParam, "Missing '#{param_desc(:port)}' parameter", caller
      end

      Net::HTTP.start(rhost,rport) do |http|
	yield http if block_given?
      end
    end

    def http_get(path)
      http_session do |http|
	resp = http.get(path)

	if block_given?
	  yield resp
	else
	  return resp
	end
      end
    end

    def http_post(path,fields={})
      http_session do |http|
	resp = http.post(path,fields)

	if block_given?
	  yield resp
	else
	  return resp
	end
      end
    end
  end
end
